$(function() {

  let stage = 'さ';

  function sa (evt) {
    if(stage == 'さ'){
    $("#sign_temp").text("これは指文字の【さ】です");
    $('.circle').css('display','inline');
    setTimeout(function(){
        $('.handsign_img').attr("src","../img/handsign/handsign_si.png")
        $(".circle").css('display','none');
        $(".handsign_text").text("鉄砲を打つまねをしてみよう！");
        $("#sign_temp").text("？");
        stage = 'し';
      }, 2000);
    }else{
      $("#sign_temp").text("やりなおしてください");
    }
  }

  function si (evt) {
    if(stage == 'し'){
      $("#sign_temp").text("これは指文字の【し】です");
      $('.circle').css('display','inline');
      setTimeout(function(){
        $('.handsign_img').attr("src","../img/handsign/handsign_su.png")
        $(".circle").css('display','none');
        $(".handsign_text").text("さっき手で作った鉄砲を下に向けてみよう！");
        $("#sign_temp").text("？");
        stage = 'す';
      }, 2000);
    }else{
      $("#sign_temp").text("やりなおしてください");
    }
  }

  function su (evt) {
    if(stage == 'す'){
      $("#sign_temp").text("これは指文字の【す】です");
      $('.circle').css('display','inline');
      setTimeout(function(){
        $('.handsign_img').attr("src","../img/handsign/handsign_se.png")
        $(".circle").css('display','none');
        $(".handsign_text").text("中指を立ててみよう！");
        $("#sign_temp").text("？");
        stage = 'せ';
      }, 2000);
    }else{
      $("#sign_temp").text("やりなおしてください");
    }
  }

  function se (evt) {
    if(stage == 'せ'){
      $("#sign_temp").text("これは指文字の【せ】です");
      $('.circle').css('display','inline');
      setTimeout(function(){
        $('.handsign_img').attr("src","../img/handsign/handsign_so.png")
        $(".circle").css('display','none');
        $(".handsign_text").text("人差し指で指してみよう！");
        $("#sign_temp").text("？");
        stage = 'そ';
      }, 2000);
    }else{
      $("#sign_temp").text("やりなおしてください");
    }
  }

  function so (evt) {
    if(stage == 'そ'){
      $("#sign_temp").text("これは指文字の【そ】です");
      $('.circle').css('display','inline');
      setTimeout(function(){
        $("#sign_temp").text("？");
      }, 2000);
    }else{
      $("#sign_temp").text("やりなおしてください");
    }
  }

  $('#btn-sign-next').on('click', function() {
    if(stage == さ){
      $('.handsign_img').attr("src","../img/handsign/handsign_si.png")
      $(".circle").css('display','none');
      $(".handsign_text").text("鉄砲を打つまねをしてみよう！");
      $("#sign_temp").text("？");
      stage = 'し';
    }
  });

  var trainer = new LeapTrainer.Controller();

  /*幾何学テンプレートマッチング
  **************************************************************************************/
  
  /*さ（正解）*********************************************************/
  trainer.fromJSON('{"name":"SA","pose":true,"data":[[{"x":null,"y":null,"z":null,"stroke":1},{"x":null,"y":null,"z":null,"stroke":1}]]}');
  
  /*し（正解）*********************************************************/
  trainer.fromJSON('{"name":"SI","pose":true,"data":[[{"x":0.1497079199305579,"y":-0.3153042096404733,"z":0.1071097409681247,"stroke":1},{"x":0.09378707253932503,"y":-0.17693031735588674,"z":0.01962133162928098,"stroke":1},{"x":0.03786622514809215,"y":-0.03855642507130019,"z":-0.06786707770956263,"stroke":1},{"x":-0.01805462224314075,"y":0.09981746721328633,"z":-0.15535548704840627,"stroke":1},{"x":-0.07397546963437361,"y":0.2381913594978729,"z":-0.2428438963872499,"stroke":1},{"x":-0.12989631702560653,"y":0.3765652517824594,"z":-0.3303323057260935,"stroke":1},{"x":-0.059434808714854154,"y":-0.1837831264259587,"z":0.6696676942739065,"stroke":1}]]}');
  trainer.fromJSON('{"name":"SI2","pose":true,"data":[[{"x":0.18329177500024052,"y":-0.12031221848009535,"z":0.09704712365426996,"stroke":1},{"x":0.19257412222232917,"y":-0.059641092677729275,"z":0.03134971335356748,"stroke":1},{"x":0.2018564694444177,"y":0.0010300331246368005,"z":-0.034347696947134965,"stroke":1},{"x":0.21113881666650636,"y":0.06170115892700287,"z":-0.10004510724783741,"stroke":1},{"x":-0.7888611833334936,"y":0.11722211910618496,"z":0.0059959671871349235,"stroke":1}]]}');
  trainer.fromJSON('{"name":"SI3","pose":true,"data":[[{"x":0.19325478933981766,"y":-0.1451901937161147,"z":0.1495697453662669,"stroke":1},{"x":0.1970021285954744,"y":-0.06798253599459254,"z":0.07679339795718085,"stroke":1},{"x":0.20074946785113124,"y":0.009225121726929603,"z":0.0040170505480948415,"stroke":1},{"x":0.20449680710678808,"y":0.08643277944845193,"z":-0.06875929686099118,"stroke":1},{"x":-0.7955031928932119,"y":0.11751482853532574,"z":-0.16162089701055152,"stroke":1}]]}');

  /*す（正解）*********************************************************/
  trainer.fromJSON('{"name":"SU","pose":true,"data":[[{"x":0.07850435934411942,"y":0.07546529774347766,"z":-0.3176654730998078,"stroke":1},{"x":-0.007717272046895374,"y":0.0693943856442577,"z":-0.22706618923992317,"stroke":1},{"x":-0.09393890343791012,"y":0.06332347354503776,"z":-0.13646690538003853,"stroke":1},{"x":-0.18016053482892488,"y":0.05725256144581781,"z":-0.04586762152015378,"stroke":1},{"x":-0.26638216621993965,"y":0.05118164934659725,"z":0.044731662339731026,"stroke":1},{"x":0.4696945171895504,"y":-0.3166173677251881,"z":0.6823345269001921,"stroke":1}]]}');
  trainer.fromJSON('{"name":"SU2","pose":false,"data":[[{"x":0.12993800660795918,"y":0.3288478256756789,"z":0.1349132327948359,"stroke":1},{"x":0.09700952184220901,"y":-0.00507905308000467,"z":-0.2998527786339218,"stroke":1},{"x":0.022608843114641508,"y":-0.2969374623255466,"z":-0.621907729676107,"stroke":1},{"x":-0.31373176412996806,"y":-0.09345249140160117,"z":-0.26503465488547323,"stroke":1},{"x":-0.5361284329131002,"y":0.12869130161475384,"z":0.091384045906165,"stroke":1},{"x":-0.0304994017471365,"y":0.28100581986311696,"z":0.1269307920383853,"stroke":1},{"x":0.12552915460516623,"y":0.08443661405634112,"z":-0.10562272351024127,"stroke":1},{"x":0.13085881461223048,"y":-0.3338913982367972,"z":-0.4134087337025696,"stroke":1},{"x":-0.367166757746182,"y":-0.042606119048649194,"z":-0.11481623542551633,"stroke":1},{"x":-0.03235887561267148,"y":0.2952474859007341,"z":0.1487658384567031,"stroke":1},{"x":0.2142410688405949,"y":-0.14486074402196372,"z":0.11839103622974512,"stroke":1},{"x":-0.07050334653753121,"y":-0.31585359951249964,"z":-0.3803381814522645,"stroke":1},{"x":-0.4716335377101226,"y":0.1852431858341837,"z":0.17989467504187584,"stroke":1},{"x":0.22860196301660118,"y":0.1290364564887242,"z":0.3130786721863752,"stroke":1},{"x":0.16251262978337022,"y":-0.31233663358622993,"z":-0.2294833511579059,"stroke":1},{"x":-0.37362022005560425,"y":0.023114248895612255,"z":0.08811815185201155,"stroke":1},{"x":0.24680084633182475,"y":0.29047458323230085,"z":0.23081605054040855,"stroke":1},{"x":0.2105473928030288,"y":-0.25368040519059987,"z":0.00529072281873566,"stroke":1},{"x":-0.2341205937124699,"y":-0.1328236022997144,"z":0.056570641125314625,"stroke":1},{"x":0.09530262656882049,"y":0.3795477932425299,"z":0.2140605522687964,"stroke":1},{"x":0.30194049495143904,"y":-0.17001818797383292,"z":0.3663744155058337,"stroke":1},{"x":0.4638715670868998,"y":-0.024105618126535056,"z":0.35587556167881085,"stroke":1}]]}');
  trainer.fromJSON('{"name":"SU3","pose":true,"data":[[{"x":0.0959720173087911,"y":0.11514970661165913,"z":-0.3017845618845417,"stroke":1},{"x":0.06137959750066971,"y":0.13633299772480156,"z":-0.22071382475381668,"stroke":1},{"x":0.026787177692548292,"y":0.157516288837944,"z":-0.13964308762309166,"stroke":1},{"x":-0.007805242115573069,"y":0.17869957995108643,"z":-0.05857235049236664,"stroke":1},{"x":-0.04239766192369447,"y":0.19988287106422886,"z":0.022498386638358403,"stroke":1},{"x":-0.1339358884627415,"y":-0.7875814441897191,"z":0.6982154381154583,"stroke":1}]]}');
  trainer.fromJSON('{"name":"SU4","pose":true,"data":[[{"x":0.1592690489715174,"y":0.2053809703509717,"z":-0.22261551227044563,"stroke":1},{"x":0.10029204430052202,"y":0.20089682839182865,"z":-0.16317728489625202,"stroke":1},{"x":0.04131503962952665,"y":0.1964126864326856,"z":-0.10373905752205842,"stroke":1},{"x":-0.01766196504146872,"y":0.19192854447354257,"z":-0.04430083014786482,"stroke":1},{"x":-0.28321416786009734,"y":-0.7946190296490283,"z":0.5338326848366208,"stroke":1}]]}');
  trainer.fromJSON('{"name":"SU5","pose":true,"data":[[{"x":0.07932332280245978,"y":0.16064845403180394,"z":-0.28479244113626306,"stroke":1},{"x":0.02814879833368643,"y":0.12878187018070864,"z":-0.23840251962124562,"stroke":1},{"x":-0.023025726135086924,"y":0.09691528632961327,"z":-0.19201259810622817,"stroke":1},{"x":-0.08444639500105929,"y":-0.3863456105421259,"z":0.715207558863737,"stroke":1}]]}');

  /*せ（正解）*********************************************************/
  trainer.fromJSON('{"name":"SE","pose":true,"data":[[{"x":0.21594713341980953,"y":-0.31884569547256036,"z":0.06508649740871184,"stroke":1},{"x":0.20104157196432648,"y":-0.2270514348424799,"z":0.04671831385809419,"stroke":1},{"x":0.18613601050884332,"y":-0.1352571742123994,"z":0.028350130307476518,"stroke":1},{"x":-0.6031247158929794,"y":0.6811543045274396,"z":-0.1401549415742826,"stroke":1}]]}');
  trainer.fromJSON('{"name":"SE2","pose":true,"data":[[{"x":-0.00030651455570341034,"y":-0.016748237748970413,"z":0.3472222222222222,"stroke":1},{"x":-0.0002697328090190032,"y":-0.014738449219093895,"z":0.3055555555555556,"stroke":1},{"x":0.0005762473647224137,"y":0.03148668696806431,"z":-0.6527777777777778,"stroke":1}]]}');
  trainer.fromJSON('{"name":"SE3","pose":true,"data":[[{"x":-0.039095771476395154,"y":0.03623645266607574,"z":0.3472222222222222,"stroke":1},{"x":-0.03440427889922773,"y":0.03188807834614671,"z":0.3055555555555556,"stroke":1},{"x":0.0735000503756229,"y":-0.06812453101222245,"z":-0.6527777777777778,"stroke":1}]]}');
  trainer.fromJSON('{"name":"SE4","pose":true,"data":[[{"x":0.08647826523659174,"y":0.3472222222222222,"z":0.15493602103067106,"stroke":1},{"x":0.07610087340820071,"y":0.30555555555555547,"z":0.13634369850699052,"stroke":1},{"x":-0.16257913864479243,"y":-0.6527777777777778,"z":-0.2912797195376616,"stroke":1}]]}');
  trainer.fromJSON('{"name":"SE5","pose":true,"data":[[{"x":0.14630757977136272,"y":0.27718517013982424,"z":0.29400186766203207,"stroke":1},{"x":0.1213841934955126,"y":0.24093827662005862,"z":0.22935171234470453,"stroke":1},{"x":0.09646080721966255,"y":0.204691383100293,"z":0.16470155702737665,"stroke":1},{"x":-0.3641525804865378,"y":-0.7228148298601758,"z":-0.6880551370341133,"stroke":1}]]}');

  /*そ（正解）*********************************************************/
  trainer.fromJSON('{"name":"SO","pose":true,"data":[[{"x":0.03207760649340768,"y":0.3273854813172321,"z":0.3472222222222222,"stroke":1},{"x":0.028228293714198764,"y":0.2880992235591642,"z":0.3055555555555556,"stroke":1},{"x":-0.06030590020760645,"y":-0.6154847048763963,"z":-0.6527777777777778,"stroke":1}]]}');
  trainer.fromJSON('{"name":"SO2","pose":true,"data":[[{"x":0.10010838724073048,"y":0.3438941164204904,"z":0.3472222222222222,"stroke":1},{"x":0.08809538077184284,"y":0.3026268224500317,"z":0.3055555555555556,"stroke":1},{"x":-0.18820376801257335,"y":-0.6465209388705221,"z":-0.6527777777777778,"stroke":1}]]}');
  trainer.fromJSON('{"name":"SO3","pose":true,"data":[[{"x":0.14578935443209284,"y":0.1492512016364877,"z":0.3472222222222222,"stroke":1},{"x":0.12829463190024165,"y":0.13134105744010927,"z":0.30555555555555547,"stroke":1},{"x":-0.2740839863323344,"y":-0.28059225907659685,"z":-0.6527777777777778,"stroke":1}]]}');
  trainer.fromJSON('{"name":"SO4","pose":true,"data":[[{"x":0.07872733673142977,"y":0.2983516850906267,"z":0.2366629066760093,"stroke":1},{"x":0.03532039867815705,"y":0.23388277163645776,"z":0.23316764477735674,"stroke":1},{"x":-0.00808653937511572,"y":0.1694138581822887,"z":0.22967238287870406,"stroke":1},{"x":-0.10596119603447109,"y":-0.7016483149093733,"z":-0.69950293433207,"stroke":1}]]}');

  //trainer.fromJSON('');
  
  trainer.on('SA', sa);

  trainer.on('SI', si);
  trainer.on('SI2', si);
  trainer.on('SI3', si);

  trainer.on('SU', su);
  trainer.on('SU2', su);
  trainer.on('SU3', su);
  trainer.on('SU4', su);
  trainer.on('SU5', su);
  
  trainer.on('SE', se);
  trainer.on('SE2', se);
  trainer.on('SE3', se);
  trainer.on('SE4', se);
  trainer.on('SE5', se);

  trainer.on('SO', so);
  trainer.on('SO2', so);
  trainer.on('SO3', so);
  trainer.on('SO4', so);
});